# NutriScan Production Configuration
spring.application.name=nutriscan
spring.profiles.active=prod

# ============================================
# DATABASE CONFIGURATION
# ============================================
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/nutriscan_prod}
spring.datasource.username=${DB_USERNAME:postgres}
spring.datasource.password=${DB_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Connection Pool (HikariCP)
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JPA / Hibernate
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.open-in-view=false

# ============================================
# SERVER CONFIGURATION
# ============================================
server.port=${SERVER_PORT:8080}
server.compression.enabled=true
server.compression.mime-types=application/json,application/xml,text/html,text/xml,text/plain
server.http2.enabled=true

# Error handling
server.error.include-message=never
server.error.include-stacktrace=never
server.error.include-exception=false

# ============================================
# SECURITY - JWT
# ============================================
jwt.secret=${JWT_SECRET}
jwt.expiration-ms=${JWT_EXPIRATION_MS:86400000}
jwt.header=Authorization
jwt.prefix=Bearer 

# ============================================
# LOGGING
# ============================================
logging.level.root=WARN
logging.level.com.nutriscan=INFO
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=WARN

# Log pattern
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n

# Log file
logging.file.name=logs/nutriscan-prod.log
logging.logback.rollingpolicy.max-file-size=10MB
logging.logback.rollingpolicy.max-history=30

# ============================================
# EXTERNAL APIs
# ============================================

# Edamam Nutrition Database API
edamam.nutrition.app-id=${EDAMAM_NUTRITION_APP_ID}
edamam.nutrition.app-key=${EDAMAM_NUTRITION_APP_KEY}
edamam.nutrition.base-url=https://api.edamam.com

# Edamam Nutrition Analysis API
edamam.nutrition-analysis.app-id=${EDAMAM_ANALYSIS_APP_ID}
edamam.nutrition-analysis.app-key=${EDAMAM_ANALYSIS_APP_KEY}
edamam.nutrition-analysis.base-url=https://api.edamam.com/api/nutrition-details

# OpenFoodFacts API
openfoodfacts.base-url=https://world.openfoodfacts.org/api
openfoodfacts.user-agent=${OPENFOODFACTS_USER_AGENT:NutriScan/1.0}

# Gemini AI API
gemini.api.key=${GEMINI_API_KEY}
gemini.model=gemini-2.0-flash

# ============================================
# ACTUATOR (Monitoring & Health)
# ============================================
management.endpoints.web.exposure.include=health,metrics,prometheus,info
management.endpoint.health.show-details=when-authorized
management.endpoint.health.probes.enabled=true
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# Metrics
management.metrics.enable.jvm=true
management.metrics.enable.http=true
management.metrics.enable.process=true
management.metrics.enable.system=true
management.metrics.distribution.percentiles-histogram.http.server.requests=true

# Info endpoint
management.info.env.enabled=true
management.info.java.enabled=true
management.info.os.enabled=true

# ============================================
# CACHE CONFIGURATION (Optional)
# ============================================
spring.cache.type=caffeine
spring.cache.cache-names=edamam-foods,openfoodfacts-products,user-goals,meal-scores
spring.cache.caffeine.spec=maximumSize=1000,expireAfterWrite=3600s

# Alternative: Redis Cache
# spring.cache.type=redis
# spring.redis.host=${REDIS_HOST:localhost}
# spring.redis.port=${REDIS_PORT:6379}
# spring.redis.password=${REDIS_PASSWORD:}
# spring.redis.timeout=60000

# ============================================
# CORS CONFIGURATION
# ============================================
# Configure allowed origins in production
# cors.allowed-origins=${CORS_ALLOWED_ORIGINS:https://nutriscan.app,https://app.nutriscan.com}

# ============================================
# MULTIPART / FILE UPLOAD
# ============================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=10MB

# ============================================
# JACKSON (JSON)
# ============================================
spring.jackson.serialization.write-dates-as-timestamps=false
spring.jackson.time-zone=UTC
spring.jackson.default-property-inclusion=non_null

# ============================================
# FLYWAY (Database Migrations)
# ============================================
spring.flyway.enabled=true
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true

